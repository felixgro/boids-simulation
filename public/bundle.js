(()=>{var m=class{constructor(i,t){this.ctx=i;this.callback=t;this.animationId=0;this.fps=0;this.lastCall=0}start(){this.requestNewFrame()}stop(){window.cancelAnimationFrame(this.animationId)}requestNewFrame(){this.lastCall||(this.lastCall=performance.now()),this.animationId=requestAnimationFrame(this.loop.bind(this))}loop(){let i=performance.now(),t=i-this.lastCall;this.fps=60/(t/1e3*60),this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight),this.callback(this.ctx),this.lastCall=i,this.requestNewFrame()}},w=m;var l=class{constructor(i=0,t=0){this.x=i;this.y=t}static random(i,t=!1){let s=Math.round(Math.random())?1:-1,a=Math.round(Math.random())?1:-1,e=new l(s,a).toUnit();if(i){let r=t?i:Math.random()*i;e.setMagnitude(r)}return e}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}add(i){return this.x+=i.x,this.y+=i.y,this}subtract(i){return this.x-=i.x,this.y-=i.y,this}multiply(i){return this.x*=i,this.y*=i,this}divide(i){return i===0?this:(this.x/=i,this.y/=i,this)}inverse(){return this.x*=-1,this.y*=-1,this}toUnit(){return this.divide(this.length),this}setMagnitude(i=1){return this.toUnit(),this.multiply(i),this}limit(i,t=0){return this.length>i&&this.setMagnitude(i),this.length<t&&this.setMagnitude(t),this}copy(){return new l(this.x,this.y)}},n=l;var v=(o,i)=>{let t=Math.random()*o,s=Math.random()*i;return new n(t,s)};var b=class{constructor(){this.label="boid";this.alive=!0;this.color="#fff";this.width=6;this.height=10;this.showFOV=!1;this.urge=0;this.range=0;this.fov=360;this.viewDistance=42;this.steeringForce=.2;this.minSpeed=1.2;this.maxSpeed=4;this.pos=v(window.innerWidth,window.innerHeight),this.vel=n.random(3),this.acc=new n}tick(){this.stayInBounds(),this.vel.limit(this.maxSpeed,this.minSpeed),this.pos.add(this.vel),this.vel.add(this.acc),this.acc.multiply(0)}flock(i){}canView(i){let t=i.pos.copy().subtract(this.pos),s=this.fov*Math.PI/180,a=Math.abs(Math.atan2(this.vel.y,this.vel.x)-Math.atan2(t.y,t.x)),e=t.length<=this.viewDistance,r=a<s/2||a>2*Math.PI-s/2;return e&&r&&this!==i}stayInBounds(){let i=100;this.pos.x<i&&this.acc.add(new n(this.steeringForce,0)),this.pos.x>window.innerWidth-i&&this.acc.add(new n(-this.steeringForce,0)),this.pos.y<i&&this.acc.add(new n(0,this.steeringForce)),this.pos.y>window.innerHeight-i&&this.acc.add(new n(0,-this.steeringForce)),this.acc.limit(.5)}render(i){i.save(),i.translate(this.pos.x,this.pos.y);let t=Math.atan2(this.vel.y,this.vel.x)+Math.PI/2;i.rotate(t),this.showFOV&&this.drawFOV(i),i.beginPath(),i.moveTo(0,-this.height/2),i.lineTo(-this.width/2,this.height/2),i.lineTo(this.width/2,this.height/2),i.fillStyle=this.color,i.fill(),i.closePath(),i.translate(-this.pos.x,-this.pos.y),i.restore()}drawFOV(i){i.strokeStyle="#fff",i.lineWidth=.2,i.beginPath();let t=this.fov===360?359*Math.PI/180:this.fov*Math.PI/180;i.arc(0,0,this.viewDistance,Math.PI*1.5-t/2,Math.PI*-.5+t/2),i.moveTo(0,0),i.lineTo(Math.cos(90*Math.PI/180+t/2)*this.viewDistance,Math.sin(-90*Math.PI/180+t/2)*this.viewDistance),i.moveTo(0,0),i.lineTo(Math.cos(90*Math.PI/180-t/2)*this.viewDistance,Math.sin(-90*Math.PI/180-t/2)*this.viewDistance),i.stroke(),i.closePath()}},u=b;var f=class extends u{constructor(){super(...arguments);this.label="boid";this.cohesion=1;this.alignment=1;this.seperation=1}flock(i){let t=new n,s=new n,a=new n,e=new n,r=0,p=0;for(let c of i)if(c!==this&&this.canView(c)){let d=c.pos.copy().subtract(this.pos);c.label=="enemy"?(e.add(d.copy().divide(d.length)),p++):(s.add(c.vel),t.add(c.pos),a.add(d.inverse().divide(d.length)),r++)}r>0&&(s.divide(r).setMagnitude(3).subtract(this.vel).limit(.22).multiply(this.alignment),t.divide(r).subtract(this.pos).setMagnitude(3).limit(.24).multiply(this.cohesion),a.divide(r).setMagnitude(3).limit(.315).multiply(this.seperation)),p>0&&e.divide(p).inverse().setMagnitude(.3),this.acc.add(a),this.acc.add(t),this.acc.add(s),this.acc.add(e)}},y=f;var g=class extends u{constructor(){super();this.label="enemy";this.color="#ff0000";this.minSpeed=2.6;this.maxSpeed=4.3;this.fov=320;this.viewDistance=300;this.urge=0;this.range=6;this.target=null}flock(i){let t=new n,s=[null,Infinity],a=0;for(let e of i)if(e!==this&&this.canView(e)){let r=e.pos.copy().subtract(this.pos);t.add(r.inverse().divide(r.length)),a++,s[1]>r.length&&e.label!=="enemy"&&(s=[e,r.length]),e.pos.x<this.pos.x+this.range&&e.pos.x>this.pos.x-this.range&&e.pos.y<this.pos.y+this.range&&e.pos.y>this.pos.y-this.range&&e.alive&&e.label!=="enemy"&&(e.alive=!1,this.urge-=300)}if(s[0]&&this.urge>=450){let e=s[0].pos.copy().subtract(this.pos).add(s[0].vel).setMagnitude(.28);this.acc.add(e)}else this.urge<1e3&&(t.divide(a).limit(.08),this.acc.add(t));this.urge++,this.urge>1e3&&(this.urge=1e3),this.urge<0&&(this.urge=0)}},M=g;var h=class{constructor(){this.boids=[]}static getInstance(){return h.instance||(h.instance=new h().init(10,0)),h.instance}init(i=10,t=1){this.boids=[];for(let s=0;s<i;s++)this.boids.push(new y);for(let s=0;s<t;s++)this.boids.push(new M);return this}render(i){this.boids=this.boids.filter(t=>t.alive);for(let t of this.boids)t.flock(this.boids),t.tick(),t.render(i)}},V=h;var x=()=>{let o=document.querySelector(".main-canvas");o.width=window.innerWidth,o.height=window.innerHeight,window.onresize=()=>{o.width=window.innerWidth,o.height=window.innerHeight};let i=o.getContext("2d");if(!i)throw new Error("Cannot get CanvasRenderingContext2D");return i};var C=V.getInstance();new w(x(),o=>{C.render(o)}).start();})();
//# sourceMappingURL=bundle.js.map
